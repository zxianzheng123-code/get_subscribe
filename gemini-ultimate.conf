function main(config) {
  // ========================================
  // ğŸš« Gemini ä¸å¯ç”¨åœ°åŒºï¼ˆç²¾ç¡®ç‰ˆï¼‰
  // ========================================
  const excludeRegions = [
    // ä¸­å›½ç›¸å…³
    "é¦™æ¸¯", "HK", "HONGKONG", "HONG KONG",
    "æ¾³é—¨", "MO", "MACAO", "MACAU",
    // "å°æ¹¾", "TW",  // âœ… å°æ¹¾å¯ç”¨ï¼Œä¸æ’é™¤
    // "éŸ©å›½", "KR",  // âœ… éŸ©å›½å¯ç”¨ï¼Œä¸æ’é™¤
    
    // ä¿„ç½—æ–¯åŠç›Ÿå‹
    "ä¿„ç½—æ–¯", "ä¿„", "RU", "RUSSIA",
    "ç™½ä¿„", "BY", "BELARUS",
    
    // åˆ¶è£åœ°åŒº
    "ä¼Šæœ—", "IR", "IRAN",
    "æœé²œ", "KP", "NORTH KOREA",
    "å™åˆ©äºš", "SY", "SYRIA",
    "å¤å·´", "CU", "CUBA",
    "è‹ä¸¹", "SD", "SUDAN",
    "å…‹é‡Œç±³äºš", "CRIMEA",
    
    // å¯é€‰ï¼šå…¶ä»–ä¸ç¨³å®šåœ°åŒº
    // "åœŸè€³å…¶", "TR", "TURKEY",  // åœŸè€³å…¶ç›®å‰å¯ç”¨
    // "é˜¿æ ¹å»·", "AR",  // é˜¿æ ¹å»·å¯ç”¨
  ];

  // ğŸš« æ’é™¤äº‘æœåŠ¡å•†ï¼ˆé€šå¸¸è¢«å°æˆ–ä¸ç¨³å®šï¼‰
  const excludeClouds = [
    "AZURE", "AWS", "AMAZON", 
    "GOOGLE", "GCP", "ORACLE", 
    "CLOUDFLARE", "WARP", "CF",
    "ALIBABA", "ALIYUN", "é˜¿é‡Œ",
    "TENCENT", "è…¾è®¯",
    "DIGITALOCEAN", "DO",
    "OVH", "HETZNER", "VULTR", "LINODE",
    "å®˜æ–¹", "å®˜ç½‘", "è¿‡æœŸ", "æµé‡", "å¥—é¤"  // æ’é™¤éèŠ‚ç‚¹é¡¹
  ];

  // ========================================
  // ğŸ” è¿‡æ»¤èŠ‚ç‚¹
  // ========================================
  const allProxies = config.proxies
    ?.filter(p => {
      const name = p.name.toUpperCase();
      const isBadRegion = excludeRegions.some(key => name.includes(key.toUpperCase()));
      const isCloud = excludeClouds.some(key => name.includes(key.toUpperCase()));
      return !isBadRegion && !isCloud;
    })
    .map(p => p.name) || [];

  if (allProxies.length === 0) {
    console.log("âš ï¸ æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹");
    return config;
  }

  // ========================================
  // ğŸ¤– åˆ›å»º AI ä¼˜é€‰ç»„
  // ========================================
  const aiGroup = {
    name: "ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    type: "url-test",
    url: "https://api.openai.com/v1/models",  // OpenAI å®˜æ–¹ API
    interval: 180,        // 3åˆ†é’Ÿæµ‹ä¸€æ¬¡ï¼ˆèŠ‚çœæµé‡ï¼‰
    tolerance: 50,        // å»¶è¿Ÿå®¹å·®
    lazy: false,          // å¯åŠ¨æ—¶ç«‹å³æµ‹è¯•
    "expected-status": "200,401,403",  // 401/403 ä¹Ÿè¯´æ˜èƒ½è¿é€š
    proxies: allProxies
  };

  // å¤‡é€‰ï¼šä½å»¶è¿Ÿç»„ï¼ˆä¼˜å…ˆç¾æ—¥æ–°ï¼‰
  const fastRegions = ["ç¾", "US", "USA", "æ—¥", "JP", "JAPAN", "æ–°", "SG", "SINGAPORE"];
  const fastProxies = allProxies.filter(name => 
    fastRegions.some(key => name.toUpperCase().includes(key))
  );
  
  const fastGroup = {
    name: "âš¡ ä½å»¶è¿ŸèŠ‚ç‚¹",
    type: "url-test",
    url: "https://www.gstatic.com/generate_204",
    interval: 300,
    tolerance: 50,
    proxies: fastProxies.length > 0 ? fastProxies : allProxies
  };

  // ========================================
  // ğŸ“¦ æ·»åŠ åˆ°é…ç½®
  // ========================================
  if (!config["proxy-groups"]) config["proxy-groups"] = [];
  
  // æ·»åŠ æ–°ç»„åˆ°æœ€å‰é¢
  config["proxy-groups"].unshift(fastGroup);
  config["proxy-groups"].unshift(aiGroup);

  // æŠŠæ–°ç»„æ·»åŠ åˆ°æ‰€æœ‰ select ç»„
  config["proxy-groups"].forEach(group => {
    if (group.type === "select" && !["ğŸ¤– AIæœåŠ¡ä¼˜é€‰", "âš¡ ä½å»¶è¿ŸèŠ‚ç‚¹"].includes(group.name)) {
      const newOptions = ["ğŸ¤– AIæœåŠ¡ä¼˜é€‰", "âš¡ ä½å»¶è¿ŸèŠ‚ç‚¹"];
      newOptions.forEach(opt => {
        if (!group.proxies?.includes(opt)) {
          group.proxies?.unshift(opt);
        }
      });
    }
  });

  // ========================================
  // ğŸ“‹ AI æœåŠ¡è§„åˆ™
  // ========================================
  const aiRules = [
    // OpenAI / ChatGPT
    "DOMAIN-SUFFIX,openai.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,chatgpt.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,oaistatic.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,oaiusercontent.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,auth0.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,challenges.cloudflare.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    
    // Google Gemini
    "DOMAIN-SUFFIX,gemini.google.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,bard.google.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,aistudio.google.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,ai.google.dev,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,generativelanguage.googleapis.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,proactivebackend-pa.googleapis.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,alkalimakersuite-pa.clients6.google.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    
    // Claude / Anthropic
    "DOMAIN-SUFFIX,anthropic.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,claude.ai,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    
    // Perplexity
    "DOMAIN-SUFFIX,perplexity.ai,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    
    // Poe
    "DOMAIN-SUFFIX,poe.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    
    // Midjourney
    "DOMAIN-SUFFIX,midjourney.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    
    // Copilot
    "DOMAIN-SUFFIX,copilot.microsoft.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,sydney.bing.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    
    // Grok
    "DOMAIN-SUFFIX,grok.x.ai,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,x.ai,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
  ];

  if (!config.rules) config.rules = [];
  config.rules.unshift(...aiRules);

  // ========================================
  // ğŸ“Š è¾“å‡ºç»Ÿè®¡
  // ========================================
  console.log(`âœ… AIä¼˜é€‰ç»„: ${allProxies.length} ä¸ªèŠ‚ç‚¹`);
  console.log(`âœ… ä½å»¶è¿Ÿç»„: ${fastProxies.length} ä¸ªèŠ‚ç‚¹`);
  console.log(`âœ… å·²æ·»åŠ  ${aiRules.length} æ¡AIè§„åˆ™`);

  return config;
}
