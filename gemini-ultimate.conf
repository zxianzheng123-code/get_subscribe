function main(config) {
  // ========================================
  // ğŸš« æ’é™¤åœ°åŒºï¼ˆGemini ä¸å¯ç”¨ï¼‰
  // ========================================
  const excludeRegions = [
    "é¦™æ¸¯", "HK", "HONGKONG", "HONG KONG",
    "æ¾³é—¨", "MO", "MACAO", "MACAU",
    "ä¿„ç½—æ–¯", "ä¿„", "RU", "RUSSIA",
    "ç™½ä¿„", "BY", "BELARUS",
    "ä¼Šæœ—", "IR", "IRAN",
    "æœé²œ", "KP", "NORTH KOREA",
    "å™åˆ©äºš", "SY", "SYRIA",
    "å¤å·´", "CU", "CUBA",
    "è‹ä¸¹", "SD", "SUDAN",
    "å…‹é‡Œç±³äºš", "CRIMEA",
  ];

  // ğŸš« æ’é™¤äº‘æœåŠ¡å•†
  const excludeClouds = [
    "AZURE", "AWS", "AMAZON", 
    "GOOGLE", "GCP", "ORACLE", 
    "CLOUDFLARE", "WARP", "CF",
    "ALIBABA", "ALIYUN", "é˜¿é‡Œ",
    "TENCENT", "è…¾è®¯",
    "DIGITALOCEAN", "DO",
    "OVH", "HETZNER", "VULTR", "LINODE",
    "å®˜æ–¹", "å®˜ç½‘", "è¿‡æœŸ", "æµé‡", "å¥—é¤"
  ];

  // ========================================
  // ğŸ” è¿‡æ»¤èŠ‚ç‚¹
  // ========================================
  const allProxies = config.proxies
    ?.filter(p => {
      const name = p.name.toUpperCase();
      const isBadRegion = excludeRegions.some(key => name.includes(key.toUpperCase()));
      const isCloud = excludeClouds.some(key => name.includes(key.toUpperCase()));
      return !isBadRegion && !isCloud;
    })
    .map(p => p.name) || [];

  if (allProxies.length === 0) {
    console.log("âš ï¸ æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹");
    return config;
  }

  // ========================================
  // ğŸ—‘ï¸ åˆ é™¤åŸæœ‰çš„ url-test ç»„
  // ========================================
  const removedGroups = [];
  
  if (config["proxy-groups"]) {
    config["proxy-groups"] = config["proxy-groups"].filter(group => {
      if (group.type === "url-test" || group.type === "fallback") {
        removedGroups.push(group.name);
        return false;  // åˆ é™¤
      }
      return true;  // ä¿ç•™
    });
  }

  // ========================================
  // ğŸ¤– åˆ›å»ºæ–°çš„ AI ä¼˜é€‰ç»„
  // ========================================
  const aiGroup = {
    name: "ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    type: "url-test",
    url: "https://api.openai.com/v1/models",
    interval: 180,
    tolerance: 50,
    lazy: false,
    "expected-status": "200,401,403",
    proxies: allProxies
  };

  // âš¡ ä½å»¶è¿Ÿç»„
  const fastRegions = ["ç¾", "US", "USA", "æ—¥", "JP", "JAPAN", "æ–°", "SG", "SINGAPORE"];
  const fastProxies = allProxies.filter(name => 
    fastRegions.some(key => name.toUpperCase().includes(key))
  );
  
  const fastGroup = {
    name: "âš¡ ä½å»¶è¿ŸèŠ‚ç‚¹",
    type: "url-test",
    url: "https://www.gstatic.com/generate_204",
    interval: 300,
    tolerance: 50,
    proxies: fastProxies.length > 0 ? fastProxies : allProxies
  };

  // ========================================
  // ğŸ“¦ æ·»åŠ æ–°ç»„
  // ========================================
  if (!config["proxy-groups"]) config["proxy-groups"] = [];
  
  config["proxy-groups"].unshift(fastGroup);
  config["proxy-groups"].unshift(aiGroup);

  // ========================================
  // ğŸ”„ æ›´æ–° select ç»„ä¸­çš„å¼•ç”¨
  // ========================================
  config["proxy-groups"].forEach(group => {
    if (group.type === "select") {
      // åˆ é™¤å¯¹å·²ç§»é™¤ç»„çš„å¼•ç”¨
      if (group.proxies) {
        group.proxies = group.proxies.filter(p => !removedGroups.includes(p));
      }
      
      // æ·»åŠ æ–°ç»„åˆ°é€‰é¡¹
      const newOptions = ["ğŸ¤– AIæœåŠ¡ä¼˜é€‰", "âš¡ ä½å»¶è¿ŸèŠ‚ç‚¹"];
      newOptions.forEach(opt => {
        if (!group.proxies?.includes(opt)) {
          group.proxies?.unshift(opt);
        }
      });
    }
  });

  // ========================================
  // ğŸ“‹ AI æœåŠ¡è§„åˆ™
  // ========================================
  const aiRules = [
    // OpenAI / ChatGPT
    "DOMAIN-SUFFIX,openai.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,chatgpt.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,oaistatic.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,oaiusercontent.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,auth0.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    
    // Google Gemini
    "DOMAIN-SUFFIX,gemini.google.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,bard.google.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,aistudio.google.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,ai.google.dev,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,generativelanguage.googleapis.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,proactivebackend-pa.googleapis.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    
    // Claude / Anthropic
    "DOMAIN-SUFFIX,anthropic.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,claude.ai,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    
    // å…¶ä»– AI
    "DOMAIN-SUFFIX,perplexity.ai,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,poe.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,midjourney.com,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
    "DOMAIN-SUFFIX,x.ai,ğŸ¤– AIæœåŠ¡ä¼˜é€‰",
  ];

  if (!config.rules) config.rules = [];
  config.rules.unshift(...aiRules);

  // ========================================
  // ğŸ“Š è¾“å‡ºç»Ÿè®¡
  // ========================================
  console.log(`ğŸ—‘ï¸ å·²åˆ é™¤åŸæœ‰ç»„: ${removedGroups.join(", ") || "æ— "}`);
  console.log(`âœ… AIä¼˜é€‰ç»„: ${allProxies.length} ä¸ªèŠ‚ç‚¹`);
  console.log(`âœ… ä½å»¶è¿Ÿç»„: ${fastProxies.length} ä¸ªèŠ‚ç‚¹`);

  return config;
}
